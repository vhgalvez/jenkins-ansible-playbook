# templates\jenkins\values.yaml.j2
# ───────────────────────────────────────────────────────────────────────────────
# Jenkins Helm chart values | probado con chart 5.8.63 (Jenkins 2.504.3-jdk21)
# ───────────────────────────────────────────────────────────────────────────────
controller:
  serviceType: ClusterIP
  servicePort: 8080
  targetPort: 8080

  # ---------------------------------------------------------------------------
  # Ingress (Traefik v3)
  # ---------------------------------------------------------------------------
  ingress:
    enabled: true
    ingressClassName: traefik
    hostName: "{{ jenkins_dashboard_domain }}"
    annotations:
      traefik.ingress.kubernetes.io/router.entrypoints: websecure
      traefik.ingress.kubernetes.io/router.tls: "true"
      traefik.ingress.kubernetes.io/auth-type: basic
      traefik.ingress.kubernetes.io/auth-secret: "{{ jenkins_secret_name }}"
{% if http_to_https_redirect | default(false) %}
      traefik.ingress.kubernetes.io/router.middlewares: default-redirectscheme@kubernetescrd
{% endif %}
    paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: jenkins
            port:
              number: 8080

  # ---------------------------------------------------------------------------
  # (Opcional) probes: deja los valores por defecto del chart
  # ---------------------------------------------------------------------------
  # healthProbes:
  #   livenessProbe: …
  #   readinessProbe: …
  #   startupProbe: …

  # ---------------------------------------------------------------------------
  # Configuration-as-Code (solo bloque de seguridad)
  # ---------------------------------------------------------------------------
  JCasC:
    enabled: true
    configScripts:
      security: |
        jenkins:
          securityRealm:
            local:
              allowsSignup: false
              users:
                - id: {{ jenkins_auth_user_ui }}
                  password: {{ jenkins_auth_pass_ui }}
          authorizationStrategy:
            loggedInUsersCanDoAnything:
              allowAnonymousRead: false

  # ---------------------------------------------------------------------------
  # Plugins (versiones fijas para evitar incompatibilidades)
  # ---------------------------------------------------------------------------
  installPlugins:
    - kubernetes:4358.vcfd9c5a_0a_f51
    - kubernetes-client-api:6.15.0-550.v2229d7b_220d1
    - workflow-aggregator:608.v67378e9d3db_1
    - configuration-as-code:1971.vf9280461ea_89
    - git:5.7.0
    - credentials:1311.vcf0a_474e4f29
    - matrix-auth:3.3
  overwritePlugins: true

  # ---------------------------------------------------------------------------
  # Recursos (ajusta a tu clúster)
  # ---------------------------------------------------------------------------
  resources:
    requests:
      cpu: 200m
      memory: 512Mi
    limits:
      cpu: "2"
      memory: 4Gi

# ------------------------------------------------------------------------------
# Si NO vas a lanzar agentes en Kubernetes, descomenta para deshabilitarlos
# agent:
#   enabled: false
# ------------------------------------------------------------------------------